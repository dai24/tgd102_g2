<!DOCTYPE html>
<html lang="en">
    @@include('./layout/head.html',{
        "title" : "學生會員-編輯個人資料"
    })
<body>
    @@include('./layout/header.html')
    
    <div class="companyEditWrapper">
        <div class="companyEditTitle">
            <h3>會員資訊</h3>
        </div>
        <table id="table">     
            <tbody>
                <tr class="item">
                    <td class="id"><h3>會員名稱</h3></td>
                    <td class="detail"><h3 class="para" id="stuTitle"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>手機</h3></td>
                    <td class="detail"><h3 class="para" id="phone"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>電子郵件</h3></td>
                    <td class="detail"><h3 class="para" id="email"></h3><textarea type="text" class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>性別</h3></td>
                    <td class="detail"><h3 class="para" id="gender"></h3><textarea type="text"  class="area" ></textarea></td>
                    <td class="editIcon"></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>生日</h3></td>
                    <td class="detail"><h3 class="para"  id="birthday"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>密碼</h3></td>
                    <td class="detail"><h3 class="para" id="password"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>通訊地址</h3></td>
                    <td class="detail"><h3 class="para"  id="address"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

            </tbody>
        </table>

        <div>
            <input type="submit" class="btna17 save" value="儲存" name="submit">
        </div>
    </div>
    @@include('./layout/footer.html')
    <script src="./js/student_edit.js"></script>
    <script>
        let editIcon = document.getElementsByClassName('fa-solid fa-pen')

        for(let i = 0; i < editIcon.length; i++){
            editIcon[i].addEventListener('click', function(e){
                let areaEdit = e.target.parentNode.parentNode.children[1].lastChild
                let paraTextFirst = e.target.parentNode.parentNode.children[1].firstChild
                console.log(paraTextFirst);
                console.log(this);
                let editIconThis = this
                if(areaEdit.classList.contains('on')){
                    console.log(this);
                    areaEdit.classList.remove("on")
                    editIconThis.style.color='black'
                    areaEdit.style.display = 'none'
                    paraTextFirst.style.display = 'block'
                }else{
                        editIconThis.style.color='#EAA565'
                        areaEdit.classList.add("on")
                        let codePath = document.getElementsByClassName('area');
                        paraTextFirst.style.display = 'none'
                        areaEdit.style.display = 'block'
                        areaEdit.value = paraTextFirst.innerText
                        for(let i = 0; i < codePath.length; i++){
                            let para = document.getElementsByClassName('para');
                            codePath[i].addEventListener('input', function(){
                                this.style.height = 'auto';
                                this.style.height = `${this.scrollHeight}px`;
                            })
                            codePath[i].addEventListener('blur', function(e){
                                console.log('123');
                                editIconThis.style.color='black'
                                let paraText = e.target.parentNode.children[0]
                                paraText.innerText = codePath[i].value
                                codePath[i].style.display = 'none'
                                paraTextFirst.style.display = 'block'
                                codePath[i].classList.remove("on")
                            })
                            codePath[i].addEventListener('keyup', function(e){
                                if(e.which == '13'){
                                    console.log('123');
                                    editIconThis.style.color='black'
                                    let paraText = e.target.parentNode.children[0]
                                    paraText.innerText = codePath[i].value
                                    codePath[i].style.display = 'none'
                                    paraTextFirst.style.display = 'block'
                                    codePath[i].classList.remove("on")
                                }
                            })
                            

                        }
                    }
                    
            })
        }

        let stuMember = []   
        let stuTitle = document.getElementById('stuTitle')
        let address = document.getElementById('address')
        let email = document.getElementById('email')
        let phone = document.getElementById('phone')
        let gender = document.getElementById('gender')
        let birthday = document.getElementById('birthday')
        let password = document.getElementById('password')
        
       
        fetch(`../php/editStudent.php?stuId=${sessionStorage.getItem('StudentId')}`)
        .then(rsp => rsp.json())
        .then(userArr => {
            stuMember = userArr
            stuTitle.innerText = stuMember[0].NAME
            address.innerText = stuMember[0].ADDRESS
            email.innerText = stuMember[0].EMAIL
            phone.innerText = stuMember[0].PHONE
            gender.innerText = stuMember[0].GENDER
            birthday.innerText = stuMember[0].BIRTHDAY
            password.innerText = stuMember[0].PASSWORD

            if(password.innerText = stuMember[0].PASSWORD){
                password.innerText = "********"
            }
            
        })
       



    </script>
</body>
</html>