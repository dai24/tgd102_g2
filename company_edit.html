<!DOCTYPE html>
<html lang="en">
    @@include('./layout/head.html',{
        "title" : "企業會員-編輯公司資訊"
    })
<body>
    @@include('./layout/header.html')
    
    <div class="companyEditWrapper">
        <div class="companyEditTitle">
            <h3>會員資訊</h3>
        </div>
        <table id="table">     
            <tbody>
                <tr class="item">
                    <td class="id"><h3>公司名稱</h3></td>
                    <td class="detail"><h3 class="para" id="comTitle"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>公司介紹</h3></td>
                    <td class="detail"><h3 class="para" id="comIntro"></h3><textarea type="text" class="area" ></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>公司規模</h3></td>
                    <td class="detail"><h3 class="para" id="range">小規模</h3><textarea type="text"  class="area" ></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>

                <tr class="item">
                    <td class="id"><h3>服務項目</h3></td>
                    <td class="detail"><h3 class="para" id="serve"></h3><textarea type="text" class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr> 
                <tr class="item">
                    <td class="id"><h3>資本額/萬</h3></td>
                    <td class="detail"><span class="para" id="property"></span><textarea type="text" class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>               
                <tr class="item">
                    <td class="id"><h3>公司地址</h3></td>
                    <td class="detail"><h3 class="para" id="address"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>
                <tr class="item">
                    <td class="id"><h3>聯絡信箱</h3></td>
                    <td class="detail"><h3 class="para" id="email"></h3><textarea type="text" class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>
                <tr class="item">
                    <td class="id"><h3>負責人</h3></td>
                    <td class="detail"><h3 class="para" id="principle"></h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>
                <tr class="item">
                    <td class="id"><h3>公司電話</h3></td>
                    <td class="detail"><h3 class="para" id="phone">(02)26789348 分機103</h3><textarea type="text" disabled="disabled" class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>
                <tr class="item">
                    <td class="id"><h3>負責人手機</h3></td>
                    <td class="detail"><h3 class="para" id="perPhone">0988273788</h3><textarea type="text"  class="area"></textarea></td>
                    <td class="editIcon"><i class="fa-solid fa-pen"></i></td>
                </tr>
                <tr class="item">
                    <td class="id"><h3>年費方案</h3></td>
                    <td class="detail"><h3 class="para" id="coin"></h3><textarea type="text" class="area"></textarea></td>
                    <td class="editIcon"></td>
                </tr>
                <tr class="item company_photochange">
                    <td class="id"><h3>公司照片</h3></td>
                    <td class="detail">
                        
                        <label for="upload" class="upload" id="imgLabel">
                            <!-- <img src="" alt="" class="imgCom">
                            <img src="" alt="" class="imgCom">
                            <img src="" alt="" class="imgCom"> -->
                            <input id="upload" type="file" multiple="multiple" accept=".jpg">
                        </label>
                    </td>
                    
                    <td class="editIcon"></td>

                </tr>
            </tbody>
        </table>

        <div>
            <input type="button" class="btna17 save" value="儲存" name="submit" id="submit">
        </div>
    </div>
    @@include('./layout/footer.html')
    <script src="./js/company_edit.js"></script>
    <script>
        let editIcon = document.getElementsByClassName('fa-solid fa-pen')

        for(let i = 0; i < editIcon.length; i++){
            editIcon[i].addEventListener('click', function(e){
                let areaEdit = e.target.parentNode.parentNode.children[1].lastChild
                let paraTextFirst = e.target.parentNode.parentNode.children[1].firstChild
                console.log(paraTextFirst);
                console.log(this);
                let editIconThis = this
                if(areaEdit.classList.contains('on')){
                    console.log(this);
                    areaEdit.classList.remove("on")
                    editIconThis.style.color='black'
                    areaEdit.style.display = 'none'
                    paraTextFirst.style.display = 'block'
                }else{
                        editIconThis.style.color='#EAA565'
                        areaEdit.classList.add("on")
                        let codePath = document.getElementsByClassName('area');
                        paraTextFirst.style.display = 'none'
                        areaEdit.style.display = 'block'
                        areaEdit.value = paraTextFirst.innerText
                        for(let i = 0; i < codePath.length; i++){
                            let para = document.getElementsByClassName('para');
                            codePath[i].addEventListener('input', function(){
                                this.style.height = 'auto';
                                this.style.height = `${this.scrollHeight}px`;
                            })
                            codePath[i].addEventListener('blur', function(e){
                                console.log('123');
                                editIconThis.style.color='black'
                                let paraText = e.target.parentNode.children[0]
                                paraText.innerText = codePath[i].value
                                codePath[i].style.display = 'none'
                                paraTextFirst.style.display = 'block'
                                codePath[i].classList.remove("on")
                            })
                            codePath[i].addEventListener('keyup', function(e){
                                if(e.which == '13'){
                                    console.log('123');
                                    editIconThis.style.color='black'
                                    let paraText = e.target.parentNode.children[0]
                                    paraText.innerText = codePath[i].value
                                    codePath[i].style.display = 'none'
                                    paraTextFirst.style.display = 'block'
                                    codePath[i].classList.remove("on")
                                }
                            })
                            

                        }
                    }
                    
            })
        }

        let imgLabel = document.getElementById('imgLabel')
        let upload = document.querySelector('#upload');
        let Avatar = document.getElementsByClassName('imgCom')
        let imgStr = []
        let imgStrJoin = '' //傳到php
        upload.addEventListener('change', (e) => {
            // console.log(upload.files[0].name);
            if(imgStr.length <= 3){
                imgStr.push(upload.files[0].name)
                let readFile = new FileReader()
                readFile.readAsDataURL(upload.files[0])
                readFile.addEventListener('load', function (e) {
                    // imgBase64.push(readFile.result)
                    let str = '';
                    str += ` <img src="${readFile.result}" alt="" class='picCom'>`
                    // console.log(str);
                    imgLabel.insertAdjacentHTML("afterbegin", str)
                    let picCom = document.getElementsByClassName('picCom')
                    console.log(picCom);
                })
            }else{
                upload.setAttribute('disabled', '');
                e.preventDefault();
                alert('最多上傳三張')
            }
            imgStrJoin = imgStr.join('|') 
            console.log(imgStrJoin); 
        })

        let comMember = []   
        let comImgMu = [] 
        let comTitle = document.getElementById('comTitle')
        let comIntro = document.getElementById('comIntro')
        let range = document.getElementById('range')
        let property = document.getElementById('property')
        let serve = document.getElementById('serve')
        let address = document.getElementById('address')
        let email = document.getElementById('email')
        let principle = document.getElementById('principle')
        let phone = document.getElementById('phone')
        let perPhone = document.getElementById('perPhone')
        let coin = document.getElementById('coin')
        fetch(`./php/editCompany.php?comId=${sessionStorage.getItem('CompanyId')}`)
        .then(rsp => rsp.json())
        .then(userArr => {
            comMember = userArr
            comTitle.innerText = comMember[0].NAME
            comIntro.innerText = comMember[0].DESCRIBE
            address.innerText = comMember[0].ADDRESS
            serve.innerText = comMember[0].SERVE
            if(comMember[0].TOTAL_EMPLOYEE <= 30){
                range.innerText = comMember[0].TOTAL_EMPLOYEE
            }
            if(comMember[0].TOTAL_EMPLOYEE > 30 && comMember[0].TOTAL_EMPLOYEE <= 60){
                range.innerText = comMember[0].TOTAL_EMPLOYEE
            }
            if(comMember[0].TOTAL_EMPLOYEE > 60){
                range.innerText = comMember[0].TOTAL_EMPLOYEE
            }
            property.innerText = comMember[0].PROPERTY
            email.innerText = comMember[0].EMAIL
            principle.innerText = comMember[0].PRINCIPLE
            phone.innerText = `${comMember[0].PHONE} 分機 ${comMember[0].EXT}`
            perPhone.innerText = comMember[0].PRINCIPLE_TEL
            if(comMember[0].PRICE == 3000){
                coin.innerText = 'A方案'
            }else if(comMember[0].PRICE == 6000){
                coin.innerText = 'B方案'
            }else{
                coin.innerText = 'C方案'
            }
            comImgMu = comMember[0].PHOTO.split('|')
            imgStr = comImgMu
            let str = '';
            imgStr.forEach(element => {
                str += ` <img src="./images/${element}" alt="" class='picCom'>`
            });
            imgLabel.insertAdjacentHTML("afterbegin", str)
            imgStrJoin = comImgMu.join('|') 
            // console.log(imgStrJoin); 
        })   
    </script>
</body>
</html>